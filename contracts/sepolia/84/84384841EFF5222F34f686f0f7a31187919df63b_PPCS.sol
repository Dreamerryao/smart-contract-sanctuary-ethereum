// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

library ContractCloner {
    function clone(address target) internal returns (address) {
        bytes20 targetBytes = bytes20(target);
        address cloneContract;
        
        bytes memory initCode = hex"60806040526006805465ffffffffffff60a01b1916601960b21b1790553480156200002957600080fd5b506040518060400160405280601081526020016f05065706520436f666665652053686f760841b815250604051806040016040528060048152602001635050435360e01b8152508160009081620000819190620001f2565b506001620000908282620001f2565b505050620000ad620000a7620000f760201b60201c565b620000fb565b60408051808201909152601481527f68747470733a2f2f6d61686c6f6e6e652e66722f0000000000000000000000006020820152600790620000f09082620001f2565b50620002be565b3390565b600680546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a35050565b634e487b7160e01b600052604160045260246000fd5b600181811c908216806200017857607f821691505b6020821081036200019957634e487b7160e01b600052602260045260246000fd5b50919050565b601f821115620001ed57600081815260208120601f850160051c81016020861015620001c85750805b601f850160051c820191505b81811015620001e957828155600101620001d4565b5050505b505050565b81516001600160401b038111156200020e576200020e6200014d565b62000226816200021f845462000163565b846200019f565b602080601f8311600181146200025e5760008415620002455750858301515b600019600386901b1c1916600185901b178555620001e9565b600085815260208120601f198616915b828110156200028f578886015182559484019460019091019084016200026e565b5085821015620002ae5787850151600019600388901b60f8161c191681555b5050505050600190811b01905550565b611ea680620002ce6000396000f3fe6080604052600436106101b75760003560e01c8063715018a6116100ec578063a22cb4651161008a578063c87b56dd11610064578063c87b56dd146104e9578063d547cfb714610509578063e985e9c51461051e578063f2fde38b1461053e57600080fd5b8063a22cb46514610475578063b88d4fde14610495578063c002d23d146104b557600080fd5b8063902d55a5116100c6578063902d55a5146103f85780639293a5c71461042d57806395d89b411461044d5780639fd2135c1461046257600080fd5b8063715018a6146103b2578063858e83b5146103c75780638da5cb5b146103da57600080fd5b806323b872dd1161015957806342842e0e1161013357806342842e0e1461032357806349852741146103435780636352211e1461036457806370a082311461038457600080fd5b806323b872dd146102ce57806330176e13146102ee5780633ccfd60b1461030e57600080fd5b8063081812fc11610195578063081812fc14610235578063095ea7b31461026d5780630de68e551461028d5780630f2ee0b1146102ae57600080fd5b806301ffc9a7146101bc57806306fdde03146101f15780630769dd8c14610213575b600080fd5b3480156101c857600080fd5b506101dc6101d73660046117b2565b61055e565b60405190151581526020015b60405180910390f35b3480156101fd57600080fd5b506102066105b0565b6040516101e8919061181f565b34801561021f57600080fd5b5061023361022e366004611847565b610642565b005b34801561024157600080fd5b50610255610250366004611862565b610668565b6040516001600160a01b0390911681526020016101e8565b34801561027957600080fd5b50610233610288366004611892565b61068f565b34801561029957600080fd5b506006546101dc90600160c01b900460ff1681565b3480156102ba57600080fd5b506102336102c93660046118bc565b6107a9565b3480156102da57600080fd5b506102336102e93660046118e0565b6107d3565b3480156102fa57600080fd5b506102336103093660046119a8565b610804565b34801561031a57600080fd5b5061023361081c565b34801561032f57600080fd5b5061023361033e3660046118e0565b6108a3565b34801561034f57600080fd5b506006546101dc90600160c81b900460ff1681565b34801561037057600080fd5b5061025561037f366004611862565b6108be565b34801561039057600080fd5b506103a461039f3660046119f1565b61091e565b6040519081526020016101e8565b3480156103be57600080fd5b506102336109a4565b6102336103d5366004611a0c565b6109b8565b3480156103e657600080fd5b506006546001600160a01b0316610255565b34801561040457600080fd5b5060065461041a90600160b01b900461ffff1681565b60405161ffff90911681526020016101e8565b34801561043957600080fd5b50610233610448366004611847565b610b9b565b34801561045957600080fd5b50610206610bc1565b610233610470366004611a0c565b610bd0565b34801561048157600080fd5b50610233610490366004611a2f565b610dab565b3480156104a157600080fd5b506102336104b0366004611a62565b610db6565b3480156104c157600080fd5b506104d06608626851ab800081565b60405167ffffffffffffffff90911681526020016101e8565b3480156104f557600080fd5b50610206610504366004611862565b610dee565b34801561051557600080fd5b50610206610e55565b34801561052a57600080fd5b506101dc610539366004611ade565b610ee3565b34801561054a57600080fd5b506102336105593660046119f1565b610f11565b60006001600160e01b031982166380ac58cd60e01b148061058f57506001600160e01b03198216635b5e139f60e01b145b806105aa57506301ffc9a760e01b6001600160e01b03198316145b92915050565b6060600080546105bf90611b08565b80601f01602080910402602001604051908101604052809291908181526020018280546105eb90611b08565b80156106385780601f1061060d57610100808354040283529160200191610638565b820191906000526020600020905b81548152906001019060200180831161061b57829003601f168201915b5050505050905090565b61064a610f87565b60068054911515600160c81b0260ff60c81b19909216919091179055565b600061067382610fe1565b506000908152600460205260409020546001600160a01b031690565b600061069a826108be565b9050806001600160a01b0316836001600160a01b03160361070c5760405162461bcd60e51b815260206004820152602160248201527f4552433732313a20617070726f76616c20746f2063757272656e74206f776e656044820152603960f91b60648201526084015b60405180910390fd5b336001600160a01b038216148061072857506107288133610ee3565b61079a5760405162461bcd60e51b815260206004820152603e60248201527f4552433732313a20617070726f76652063616c6c6572206973206e6f7420746f60448201527f6b656e206f776e6572206e6f7220617070726f76656420666f7220616c6c00006064820152608401610703565b6107a48383611040565b505050565b6107b1610f87565b6006805461ffff909216600160b01b0261ffff60b01b19909216919091179055565b6107dd33826110ae565b6107f95760405162461bcd60e51b815260040161070390611b42565b6107a483838361110d565b61080c610f87565b60076108188282611bde565b5050565b610824610f87565b600047116108745760405162461bcd60e51b815260206004820152601960248201527f436f6e74726163742062616c616e6365206973207a65726f2e000000000000006044820152606401610703565b60405133904780156108fc02916000818181858888f193505050501580156108a0573d6000803e3d6000fd5b50565b6107a483838360405180602001604052806000815250610db6565b6000818152600260205260408120546001600160a01b0316806105aa5760405162461bcd60e51b8152602060048201526018602482015277115490cdcc8c4e881a5b9d985b1a59081d1bdad95b88125160421b6044820152606401610703565b60006001600160a01b0382166109885760405162461bcd60e51b815260206004820152602960248201527f4552433732313a2061646472657373207a65726f206973206e6f7420612076616044820152683634b21037bbb732b960b91b6064820152608401610703565b506001600160a01b031660009081526003602052604090205490565b6109ac610f87565b6109b660006112a9565b565b600654600160c01b900460ff16610a0a5760405162461bcd60e51b81526020600482015260166024820152755075626c6963204d696e74204e6f742041637469766560501b6044820152606401610703565b601460ff8216610a193361091e565b610a239190611cb4565b1115610a6c5760405162461bcd60e51b815260206004820152601860248201527713585e081d1bdad95b881b5a5b9d081a5b881dd85b1b195d60421b6044820152606401610703565b34610a8160ff83166608626851ab8000611cc7565b67ffffffffffffffff161115610ad95760405162461bcd60e51b815260206004820152601f60248201527f45746865722076616c75652073656e74206973206e6f7420636f7272656374006044820152606401610703565b60065461ffff600160b01b8204811691610aff9160ff851691600160a01b900416611cf3565b61ffff161115610b445760405162461bcd60e51b815260206004820152601060248201526f09ac2f040a6eae0e0d8f240a4cac2c6d60831b6044820152606401610703565b60005b8160ff168160ff161015610818576006805461ffff60a01b1981166001600160a01b9283900461ffff9081168201169092021790915501610b96335b600654600160a01b900461ffff166112fb565b610b47565b610ba3610f87565b60068054911515600160c01b0260ff60c01b19909216919091179055565b6060600180546105bf90611b08565b600654600160c81b900460ff16610c295760405162461bcd60e51b815260206004820152601760248201527f416c6c6f776564204d696e74204e6f74204163746976650000000000000000006044820152606401610703565b601460ff8216610c383361091e565b610c429190611cb4565b1115610c8b5760405162461bcd60e51b815260206004820152601860248201527713585e081d1bdad95b881b5a5b9d081a5b881dd85b1b195d60421b6044820152606401610703565b34610ca060ff83166608626851ab8000611cc7565b67ffffffffffffffff161115610cf85760405162461bcd60e51b815260206004820152601f60248201527f45746865722076616c75652073656e74206973206e6f7420636f7272656374006044820152606401610703565b60065461ffff600160b01b8204811691610d1e9160ff851691600160a01b900416611cf3565b61ffff161115610d635760405162461bcd60e51b815260206004820152601060248201526f09ac2f040a6eae0e0d8f240a4cac2c6d60831b6044820152606401610703565b60005b8160ff168160ff161015610818576006805461ffff60a01b1981166001600160a01b9283900461ffff9081168201169092021790915501610da633610b83565b610d66565b610818338383611315565b610dc033836110ae565b610ddc5760405162461bcd60e51b815260040161070390611b42565b610de8848484846113e3565b50505050565b6060610df982610fe1565b6000610e03611416565b90506000815111610e235760405180602001604052806000815250610e4e565b80610e2d84611425565b604051602001610e3e929190611d15565b6040516020818303038152906040525b9392505050565b60078054610e6290611b08565b80601f0160208091040260200160405190810160405280929190818152602001828054610e8e90611b08565b8015610edb5780601f10610eb057610100808354040283529160200191610edb565b820191906000526020600020905b815481529060010190602001808311610ebe57829003601f168201915b505050505081565b6001600160a01b03918216600090815260056020908152604080832093909416825291909152205460ff1690565b610f19610f87565b6001600160a01b038116610f7e5760405162461bcd60e51b815260206004820152602660248201527f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160448201526564647265737360d01b6064820152608401610703565b6108a0816112a9565b6006546001600160a01b031633146109b65760405162461bcd60e51b815260206004820181905260248201527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e65726044820152606401610703565b6000818152600260205260409020546001600160a01b03166108a05760405162461bcd60e51b8152602060048201526018602482015277115490cdcc8c4e881a5b9d985b1a59081d1bdad95b88125160421b6044820152606401610703565b600081815260046020526040902080546001600160a01b0319166001600160a01b0384169081179091558190611075826108be565b6001600160a01b03167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92560405160405180910390a45050565b6000806110ba836108be565b9050806001600160a01b0316846001600160a01b031614806110e157506110e18185610ee3565b806111055750836001600160a01b03166110fa84610668565b6001600160a01b0316145b949350505050565b826001600160a01b0316611120826108be565b6001600160a01b0316146111845760405162461bcd60e51b815260206004820152602560248201527f4552433732313a207472616e736665722066726f6d20696e636f72726563742060448201526437bbb732b960d91b6064820152608401610703565b6001600160a01b0382166111e65760405162461bcd60e51b8152602060048201526024808201527f4552433732313a207472616e7366657220746f20746865207a65726f206164646044820152637265737360e01b6064820152608401610703565b6111f1600082611040565b6001600160a01b038316600090815260036020526040812080546001929061121a908490611d44565b90915550506001600160a01b0382166000908152600360205260408120805460019290611248908490611cb4565b909155505060008181526002602052604080822080546001600160a01b0319166001600160a01b0386811691821790925591518493918716917fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef91a4505050565b600680546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a35050565b610818828260405180602001604052806000815250611526565b816001600160a01b0316836001600160a01b0316036113765760405162461bcd60e51b815260206004820152601960248201527f4552433732313a20617070726f766520746f2063616c6c6572000000000000006044820152606401610703565b6001600160a01b03838116600081815260056020908152604080832094871680845294825291829020805460ff191686151590811790915591519182527f17307eab39ab6107e8899845ad3d59bd9653f200f220920489ca2b5937696c31910160405180910390a3505050565b6113ee84848461110d565b6113fa84848484611559565b610de85760405162461bcd60e51b815260040161070390611d57565b6060600780546105bf90611b08565b60608160000361144c5750506040805180820190915260018152600360fc1b602082015290565b8160005b8115611476578061146081611da9565b915061146f9050600a83611dd8565b9150611450565b60008167ffffffffffffffff8111156114915761149161191c565b6040519080825280601f01601f1916602001820160405280156114bb576020820181803683370190505b5090505b8415611105576114d0600183611d44565b91506114dd600a86611dec565b6114e8906030611cb4565b60f81b8183815181106114fd576114fd611e00565b60200101906001600160f81b031916908160001a90535061151f600a86611dd8565b94506114bf565b611530838361165a565b61153d6000848484611559565b6107a45760405162461bcd60e51b815260040161070390611d57565b60006001600160a01b0384163b1561164f57604051630a85bd0160e11b81526001600160a01b0385169063150b7a029061159d903390899088908890600401611e16565b6020604051808303816000875af19250505080156115d8575060408051601f3d908101601f191682019092526115d591810190611e53565b60015b611635573d808015611606576040519150601f19603f3d011682016040523d82523d6000602084013e61160b565b606091505b50805160000361162d5760405162461bcd60e51b815260040161070390611d57565b805181602001fd5b6001600160e01b031916630a85bd0160e11b149050611105565b506001949350505050565b6001600160a01b0382166116b05760405162461bcd60e51b815260206004820181905260248201527f4552433732313a206d696e7420746f20746865207a65726f20616464726573736044820152606401610703565b6000818152600260205260409020546001600160a01b0316156117155760405162461bcd60e51b815260206004820152601c60248201527f4552433732313a20746f6b656e20616c7265616479206d696e746564000000006044820152606401610703565b6001600160a01b038216600090815260036020526040812080546001929061173e908490611cb4565b909155505060008181526002602052604080822080546001600160a01b0319166001600160a01b03861690811790915590518392907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef908290a45050565b6001600160e01b0319811681146108a057600080fd5b6000602082840312156117c457600080fd5b8135610e4e8161179c565b60005b838110156117ea5781810151838201526020016117d2565b50506000910152565b6000815180845261180b8160208601602086016117cf565b601f01601f19169290920160200192915050565b602081526000610e4e60208301846117f3565b8035801515811461184257600080fd5b919050565b60006020828403121561185957600080fd5b610e4e82611832565b60006020828403121561187457600080fd5b5035919050565b80356001600160a01b038116811461184257600080fd5b600080604083850312156118a557600080fd5b6118ae8361187b565b946020939093013593505050565b6000602082840312156118ce57600080fd5b813561ffff81168114610e4e57600080fd5b6000806000606084860312156118f557600080fd5b6118fe8461187b565b925061190c6020850161187b565b9150604084013590509250925092565b634e487b7160e01b600052604160045260246000fd5b600067ffffffffffffffff8084111561194d5761194d61191c565b604051601f8501601f19908116603f011681019082821181831017156119755761197561191c565b8160405280935085815286868601111561198e57600080fd5b858560208301376000602087830101525050509392505050565b6000602082840312156119ba57600080fd5b813567ffffffffffffffff8111156119d157600080fd5b8201601f810184136119e257600080fd5b61110584823560208401611932565b600060208284031215611a0357600080fd5b610e4e8261187b565b600060208284031215611a1e57600080fd5b813560ff81168114610e4e57600080fd5b60008060408385031215611a4257600080fd5b611a4b8361187b565b9150611a5960208401611832565b90509250929050565b60008060008060808587031215611a7857600080fd5b611a818561187b565b9350611a8f6020860161187b565b925060408501359150606085013567ffffffffffffffff811115611ab257600080fd5b8501601f81018713611ac357600080fd5b611ad287823560208401611932565b91505092959194509250565b60008060408385031215611af157600080fd5b611afa8361187b565b9150611a596020840161187b565b600181811c90821680611b1c57607f821691505b602082108103611b3c57634e487b7160e01b600052602260045260246000fd5b50919050565b6020808252602e908201527f4552433732313a2063616c6c6572206973206e6f7420746f6b656e206f776e6560408201526d1c881b9bdc88185c1c1c9bdd995960921b606082015260800190565b601f8211156107a457600081815260208120601f850160051c81016020861015611bb75750805b601f850160051c820191505b81811015611bd657828155600101611bc3565b505050505050565b815167ffffffffffffffff811115611bf857611bf861191c565b611c0c81611c068454611b08565b84611b90565b602080601f831160018114611c415760008415611c295750858301515b600019600386901b1c1916600185901b178555611bd6565b600085815260208120601f198616915b82811015611c7057888601518255948401946001909101908401611c51565b5085821015611c8e5787850151600019600388901b60f8161c191681555b5050505050600190811b01905550565b634e487b7160e01b600052601160045260246000fd5b808201808211156105aa576105aa611c9e565b67ffffffffffffffff818116838216028082169190828114611ceb57611ceb611c9e565b505092915050565b61ffff818116838216019080821115611d0e57611d0e611c9e565b5092915050565b60008351611d278184602088016117cf565b835190830190611d3b8183602088016117cf565b01949350505050565b818103818111156105aa576105aa611c9e565b60208082526032908201527f4552433732313a207472616e7366657220746f206e6f6e20455243373231526560408201527131b2b4bb32b91034b6b83632b6b2b73a32b960711b606082015260800190565b600060018201611dbb57611dbb611c9e565b5060010190565b634e487b7160e01b600052601260045260246000fd5b600082611de757611de7611dc2565b500490565b600082611dfb57611dfb611dc2565b500690565b634e487b7160e01b600052603260045260246000fd5b6001600160a01b0385811682528416602082015260408101839052608060608201819052600090611e49908301846117f3565b9695505050505050565b600060208284031215611e6557600080fd5b8151610e4e8161179c56fea2646970667358221220c77646f9f6eb1b567cd1cba406efb00e3b64d024d9de7459e5962cfe9fd4392664736f6c63430008120033"; // Votre code d'initialisation complet ici

        assembly {
            let cloneCode := mload(0x40) // Charger le prochain emplacement mémoire disponible pour le code du clone

            // Définir la longueur du code d'initialisation
            let initCodeLength := mload(initCode)
            mstore(cloneCode, initCodeLength)

            // Copier chaque partie du code d'initialisation dans la mémoire du clone
            let offset := 0x20
            for { let i := 0 } lt(i, initCodeLength) { i := add(i, 0x20) } {
                mstore(add(cloneCode, offset), mload(add(add(initCode, i), 0x20)))
                offset := add(offset, 0x20)
            }

            // Déployer le contrat clone
            cloneContract := create2(0, cloneCode, initCodeLength, targetBytes)
        }

        
        return cloneContract;
    }
}

contract PPCS {
    using ContractCloner for address;
    address public owner;
    
    constructor() {
        owner = msg.sender;
    }
    
    function cloneContract() public {
        // Cloner le contrat
        address newContract = address(this).clone();
        PPCS(newContract).setOwner(msg.sender);
    }
    
    function setOwner(address newOwner) public {
        require(msg.sender == owner, "Seul le proprietaire peut appeler cette fonction.");
        owner = newOwner;
    }
}