// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import "./lib.sol";

// TODO introduce soft delete to allow removal of sticker
struct StickerInstance {
    uint256 x;
    uint256 y;
    uint256 id;
    bool isDeleted;
}

contract Italia is ERC721Enumerable, ReentrancyGuard, Ownable {

    // First in list is default
    string[] private _laptops = [
        '<svg width="600" height="580" viewBox="0 0 600 580" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_18_103)"><rect width="600" height="580" fill="url(#paint0_radial_18_103)"/><g filter="url(#filter0_ddii_18_103)"><rect x="62" y="124" width="476" height="333" rx="23" fill="url(#paint1_linear_18_103)"/></g><g clip-path="url(#clip1_18_103)"><path opacity="0.63" d="M317.535 290.735L299.615 265.055L268.735 309.285H330.495L318.005 291.395C317.855 291.165 317.695 290.955 317.535 290.735ZM315.875 292.595C316.365 293.315 316.875 294.055 317.295 294.845C312.935 302.485 306.565 306.845 299.745 306.845C292.925 306.845 286.555 302.475 282.195 294.845C286.555 287.205 292.925 282.845 299.745 282.845C305.635 282.845 311.185 286.105 315.405 291.915L315.875 292.595ZM309.125 282.925C306.203 281.236 302.879 280.366 299.504 280.407C296.128 280.447 292.826 281.397 289.945 283.155L299.615 269.305L309.125 282.925ZM273.405 306.855L280.475 296.715C282.869 300.925 286.337 304.424 290.525 306.855H273.405ZM308.965 306.855C313.086 304.465 316.51 301.038 318.895 296.915L325.825 306.855H308.965ZM299.615 286.395C297.981 286.427 296.392 286.94 295.048 287.871C293.705 288.802 292.666 290.109 292.062 291.628C291.458 293.147 291.317 294.811 291.655 296.41C291.993 298.009 292.796 299.473 293.963 300.618C295.129 301.763 296.608 302.538 298.214 302.845C299.819 303.153 301.48 302.979 302.987 302.347C304.495 301.714 305.782 300.65 306.687 299.289C307.592 297.928 308.075 296.33 308.075 294.695C308.052 292.473 307.147 290.352 305.561 288.796C303.975 287.24 301.837 286.376 299.615 286.395ZM299.615 300.565C298.46 300.539 297.338 300.174 296.39 299.513C295.442 298.853 294.71 297.927 294.286 296.853C293.861 295.778 293.763 294.602 294.004 293.472C294.245 292.342 294.814 291.309 295.64 290.501C296.466 289.693 297.512 289.146 298.647 288.93C299.782 288.714 300.956 288.838 302.021 289.285C303.086 289.733 303.995 290.485 304.634 291.448C305.274 292.41 305.615 293.54 305.615 294.695C305.574 296.258 304.923 297.744 303.802 298.835C302.682 299.925 301.179 300.536 299.615 300.535V300.565ZM316.865 281.625L329.405 273.195L330.765 275.195L318.225 283.625L316.865 281.625ZM313.465 276.235L311.465 274.885L319.085 263.535L321.085 264.885L313.465 276.235ZM321.525 288.955L335.335 286.125L335.825 288.505L322.015 291.345L321.525 288.955ZM281.005 283.645L268.465 275.215L269.825 273.215L282.365 281.645L281.005 283.645ZM285.765 276.235L278.145 264.885L280.145 263.535L287.765 274.885L285.765 276.235ZM277.215 291.345L263.405 288.505L263.895 286.125L277.705 288.955L277.215 291.345Z" fill="url(#paint2_linear_18_103)" stroke="url(#paint3_linear_18_103)" stroke-width="0.2" stroke-miterlimit="10"/></g></g><defs><filter id="filter0_ddii_18_103" x="22" y="100" width="606" height="463" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="13" dy="3"/><feGaussianBlur stdDeviation="7"/><feComposite in2="hardAlpha" operator="out"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.06 0"/><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_18_103"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="25" dy="41"/><feGaussianBlur stdDeviation="32.5"/><feComposite in2="hardAlpha" operator="out"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.19 0"/><feBlend mode="normal" in2="effect1_dropShadow_18_103" result="effect2_dropShadow_18_103"/><feBlend mode="normal" in="SourceGraphic" in2="effect2_dropShadow_18_103" result="shape"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="-14"/><feGaussianBlur stdDeviation="12"/><feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.19 0"/><feBlend mode="normal" in2="shape" result="effect3_innerShadow_18_103"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="16" dy="-2"/><feGaussianBlur stdDeviation="9.5"/><feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1"/><feColorMatrix type="matrix" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.45 0"/><feBlend mode="normal" in2="effect3_innerShadow_18_103" result="effect4_innerShadow_18_103"/></filter><radialGradient id="paint0_radial_18_103" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(416.123 -25.7893) rotate(118.267) scale(960.105 993.163)"><stop stop-color="#9AB0C7"/><stop offset="1" stop-color="#323335"/></radialGradient><linearGradient id="paint1_linear_18_103" x1="247.704" y1="158.446" x2="618.375" y2="318.452" gradientUnits="userSpaceOnUse"><stop stop-color="#ECECEC"/><stop offset="1" stop-color="#B0B0B1"/></linearGradient><linearGradient id="paint2_linear_18_103" x1="230.615" y1="161.885" x2="341.925" y2="371.765" gradientUnits="userSpaceOnUse"><stop offset="0.08" stop-color="white"/><stop offset="0.2" stop-color="#F9F9F9"/><stop offset="0.34" stop-color="#EAEAEA"/><stop offset="0.5" stop-color="#D0D0D0"/><stop offset="0.67" stop-color="#ABABAB"/><stop offset="0.85" stop-color="#7D7D7D"/><stop offset="0.89" stop-color="#707070"/></linearGradient><linearGradient id="paint3_linear_18_103" x1="263.285" y1="286.375" x2="335.945" y2="286.375" gradientUnits="userSpaceOnUse"><stop offset="0.25" stop-color="#BFBFBF"/><stop offset="0.36" stop-color="#B4B4B4"/><stop offset="0.68" stop-color="#999999"/><stop offset="0.87" stop-color="#8F8F8F"/></linearGradient><clipPath id="clip0_18_103"><rect width="600" height="580" fill="white"/></clipPath><clipPath id="clip1_18_103"><rect width="72.66" height="46.03" fill="white" transform="translate(263.285 263.365)"/></clipPath></defs>',
        '<svg width="600" height="580" viewBox="0 0 600 580" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_18_111)"><rect width="600" height="580" fill="url(#paint0_radial_18_111)"/><g filter="url(#filter0_ddii_18_111)"><rect x="62" y="124" width="476" height="333" rx="23" fill="url(#paint1_linear_18_111)"/></g><g clip-path="url(#clip1_18_111)"><path opacity="0.63" d="M317.535 290.735L299.615 265.055L268.735 309.285H330.495L318.005 291.395C317.855 291.165 317.695 290.955 317.535 290.735ZM315.875 292.595C316.365 293.315 316.875 294.055 317.295 294.845C312.935 302.485 306.565 306.845 299.745 306.845C292.925 306.845 286.555 302.475 282.195 294.845C286.555 287.205 292.925 282.845 299.745 282.845C305.635 282.845 311.185 286.105 315.405 291.915L315.875 292.595ZM309.125 282.925C306.203 281.236 302.879 280.366 299.504 280.407C296.128 280.447 292.826 281.397 289.945 283.155L299.615 269.305L309.125 282.925ZM273.405 306.855L280.475 296.715C282.869 300.925 286.337 304.424 290.525 306.855H273.405ZM308.965 306.855C313.086 304.465 316.51 301.038 318.895 296.915L325.825 306.855H308.965ZM299.615 286.395C297.981 286.427 296.392 286.94 295.048 287.871C293.705 288.802 292.666 290.109 292.062 291.628C291.458 293.147 291.317 294.811 291.655 296.41C291.993 298.009 292.796 299.473 293.963 300.618C295.129 301.763 296.608 302.538 298.214 302.845C299.819 303.153 301.48 302.979 302.987 302.347C304.495 301.714 305.782 300.65 306.687 299.289C307.592 297.928 308.075 296.33 308.075 294.695C308.052 292.473 307.147 290.352 305.561 288.796C303.975 287.24 301.837 286.376 299.615 286.395ZM299.615 300.565C298.46 300.539 297.338 300.174 296.39 299.513C295.442 298.853 294.71 297.927 294.286 296.853C293.861 295.778 293.763 294.602 294.004 293.472C294.245 292.342 294.814 291.309 295.64 290.501C296.466 289.693 297.512 289.146 298.647 288.93C299.782 288.714 300.956 288.838 302.021 289.285C303.086 289.733 303.995 290.485 304.634 291.448C305.274 292.41 305.615 293.54 305.615 294.695C305.574 296.258 304.923 297.744 303.802 298.835C302.682 299.925 301.179 300.536 299.615 300.535V300.565ZM316.865 281.625L329.405 273.195L330.765 275.195L318.225 283.625L316.865 281.625ZM313.465 276.235L311.465 274.885L319.085 263.535L321.085 264.885L313.465 276.235ZM321.525 288.955L335.335 286.125L335.825 288.505L322.015 291.345L321.525 288.955ZM281.005 283.645L268.465 275.215L269.825 273.215L282.365 281.645L281.005 283.645ZM285.765 276.235L278.145 264.885L280.145 263.535L287.765 274.885L285.765 276.235ZM277.215 291.345L263.405 288.505L263.895 286.125L277.705 288.955L277.215 291.345Z" fill="url(#paint2_linear_18_111)" stroke="url(#paint3_linear_18_111)" stroke-width="0.2" stroke-miterlimit="10"/></g></g><defs><filter id="filter0_ddii_18_111" x="22" y="100" width="606" height="463" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="13" dy="3"/><feGaussianBlur stdDeviation="7"/><feComposite in2="hardAlpha" operator="out"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.06 0"/><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_18_111"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="25" dy="41"/><feGaussianBlur stdDeviation="32.5"/><feComposite in2="hardAlpha" operator="out"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.19 0"/><feBlend mode="normal" in2="effect1_dropShadow_18_111" result="effect2_dropShadow_18_111"/><feBlend mode="normal" in="SourceGraphic" in2="effect2_dropShadow_18_111" result="shape"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="-14"/><feGaussianBlur stdDeviation="12"/><feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.19 0"/><feBlend mode="normal" in2="shape" result="effect3_innerShadow_18_111"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="16" dy="-2"/><feGaussianBlur stdDeviation="9.5"/><feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1"/><feColorMatrix type="matrix" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.45 0"/><feBlend mode="normal" in2="effect3_innerShadow_18_111" result="effect4_innerShadow_18_111"/></filter><radialGradient id="paint0_radial_18_111" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(416.123 -25.7893) rotate(118.267) scale(960.105 993.163)"><stop stop-color="#7498EB"/><stop offset="1" stop-color="#476493"/></radialGradient><linearGradient id="paint1_linear_18_111" x1="247.704" y1="158.446" x2="618.375" y2="318.452" gradientUnits="userSpaceOnUse"><stop stop-color="#ECECEC"/><stop offset="1" stop-color="#B0B0B1"/></linearGradient><linearGradient id="paint2_linear_18_111" x1="230.615" y1="161.885" x2="341.925" y2="371.765" gradientUnits="userSpaceOnUse"><stop offset="0.08" stop-color="white"/><stop offset="0.2" stop-color="#F9F9F9"/><stop offset="0.34" stop-color="#EAEAEA"/><stop offset="0.5" stop-color="#D0D0D0"/><stop offset="0.67" stop-color="#ABABAB"/><stop offset="0.85" stop-color="#7D7D7D"/><stop offset="0.89" stop-color="#707070"/></linearGradient><linearGradient id="paint3_linear_18_111" x1="263.285" y1="286.375" x2="335.945" y2="286.375" gradientUnits="userSpaceOnUse"><stop offset="0.25" stop-color="#BFBFBF"/><stop offset="0.36" stop-color="#B4B4B4"/><stop offset="0.68" stop-color="#999999"/><stop offset="0.87" stop-color="#8F8F8F"/></linearGradient><clipPath id="clip0_18_111"><rect width="600" height="580" fill="white"/></clipPath><clipPath id="clip1_18_111"><rect width="72.66" height="46.03" fill="white" transform="translate(263.285 263.365)"/></clipPath></defs>',
        '<svg width="600" height="580" viewBox="0 0 600 580" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_18_95)"><rect width="600" height="580" fill="url(#paint0_radial_18_95)"/><g filter="url(#filter0_ddii_18_95)"><rect x="62" y="124" width="476" height="333" rx="23" fill="url(#paint1_linear_18_95)"/></g><g clip-path="url(#clip1_18_95)"><path opacity="0.63" d="M317.535 290.735L299.615 265.055L268.735 309.285H330.495L318.005 291.395C317.855 291.165 317.695 290.955 317.535 290.735ZM315.875 292.595C316.365 293.315 316.875 294.055 317.295 294.845C312.935 302.485 306.565 306.845 299.745 306.845C292.925 306.845 286.555 302.475 282.195 294.845C286.555 287.205 292.925 282.845 299.745 282.845C305.635 282.845 311.185 286.105 315.405 291.915L315.875 292.595ZM309.125 282.925C306.203 281.236 302.879 280.366 299.504 280.407C296.128 280.447 292.826 281.397 289.945 283.155L299.615 269.305L309.125 282.925ZM273.405 306.855L280.475 296.715C282.869 300.925 286.337 304.424 290.525 306.855H273.405ZM308.965 306.855C313.086 304.465 316.51 301.038 318.895 296.915L325.825 306.855H308.965ZM299.615 286.395C297.981 286.427 296.392 286.94 295.048 287.871C293.705 288.802 292.666 290.109 292.062 291.628C291.458 293.147 291.317 294.811 291.655 296.41C291.993 298.009 292.796 299.473 293.963 300.618C295.129 301.763 296.608 302.538 298.214 302.845C299.819 303.153 301.48 302.979 302.987 302.347C304.495 301.714 305.782 300.65 306.687 299.289C307.592 297.928 308.075 296.33 308.075 294.695C308.052 292.473 307.147 290.352 305.561 288.796C303.975 287.24 301.837 286.376 299.615 286.395ZM299.615 300.565C298.46 300.539 297.338 300.174 296.39 299.513C295.442 298.853 294.71 297.927 294.286 296.853C293.861 295.778 293.763 294.602 294.004 293.472C294.245 292.342 294.814 291.309 295.64 290.501C296.466 289.693 297.512 289.146 298.647 288.93C299.782 288.714 300.956 288.838 302.021 289.285C303.086 289.733 303.995 290.485 304.634 291.448C305.274 292.41 305.615 293.54 305.615 294.695C305.574 296.258 304.923 297.744 303.802 298.835C302.682 299.925 301.179 300.536 299.615 300.535V300.565ZM316.865 281.625L329.405 273.195L330.765 275.195L318.225 283.625L316.865 281.625ZM313.465 276.235L311.465 274.885L319.085 263.535L321.085 264.885L313.465 276.235ZM321.525 288.955L335.335 286.125L335.825 288.505L322.015 291.345L321.525 288.955ZM281.005 283.645L268.465 275.215L269.825 273.215L282.365 281.645L281.005 283.645ZM285.765 276.235L278.145 264.885L280.145 263.535L287.765 274.885L285.765 276.235ZM277.215 291.345L263.405 288.505L263.895 286.125L277.705 288.955L277.215 291.345Z" fill="url(#paint2_linear_18_95)" stroke="url(#paint3_linear_18_95)" stroke-width="0.2" stroke-miterlimit="10"/></g></g><defs><filter id="filter0_ddii_18_95" x="22" y="100" width="606" height="463" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="13" dy="3"/><feGaussianBlur stdDeviation="7"/><feComposite in2="hardAlpha" operator="out"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.06 0"/><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_18_95"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="25" dy="41"/><feGaussianBlur stdDeviation="32.5"/><feComposite in2="hardAlpha" operator="out"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.19 0"/><feBlend mode="normal" in2="effect1_dropShadow_18_95" result="effect2_dropShadow_18_95"/><feBlend mode="normal" in="SourceGraphic" in2="effect2_dropShadow_18_95" result="shape"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="-14"/><feGaussianBlur stdDeviation="12"/><feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.19 0"/><feBlend mode="normal" in2="shape" result="effect3_innerShadow_18_95"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="16" dy="-2"/><feGaussianBlur stdDeviation="9.5"/><feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1"/><feColorMatrix type="matrix" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.45 0"/><feBlend mode="normal" in2="effect3_innerShadow_18_95" result="effect4_innerShadow_18_95"/></filter><radialGradient id="paint0_radial_18_95" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(416.123 -25.7893) rotate(118.267) scale(960.105 993.163)"><stop stop-color="#8F9C89"/><stop offset="1" stop-color="#374132"/></radialGradient><linearGradient id="paint1_linear_18_95" x1="247.704" y1="158.446" x2="618.375" y2="318.452" gradientUnits="userSpaceOnUse"><stop stop-color="#ECECEC"/><stop offset="1" stop-color="#B0B0B1"/></linearGradient><linearGradient id="paint2_linear_18_95" x1="230.615" y1="161.885" x2="341.925" y2="371.765" gradientUnits="userSpaceOnUse"><stop offset="0.08" stop-color="white"/><stop offset="0.2" stop-color="#F9F9F9"/><stop offset="0.34" stop-color="#EAEAEA"/><stop offset="0.5" stop-color="#D0D0D0"/><stop offset="0.67" stop-color="#ABABAB"/><stop offset="0.85" stop-color="#7D7D7D"/><stop offset="0.89" stop-color="#707070"/></linearGradient><linearGradient id="paint3_linear_18_95" x1="263.285" y1="286.375" x2="335.945" y2="286.375" gradientUnits="userSpaceOnUse"><stop offset="0.25" stop-color="#BFBFBF"/><stop offset="0.36" stop-color="#B4B4B4"/><stop offset="0.68" stop-color="#999999"/><stop offset="0.87" stop-color="#8F8F8F"/></linearGradient><clipPath id="clip0_18_95"><rect width="600" height="580" fill="white"/></clipPath><clipPath id="clip1_18_95"><rect width="72.66" height="46.03" fill="white" transform="translate(263.285 263.365)"/></clipPath></defs>',
        '<svg width="600" height="580" viewBox="0 0 600 580" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_18_87)"><rect width="600" height="580" fill="url(#paint0_radial_18_87)"/><g filter="url(#filter0_ddii_18_87)"><rect x="62" y="124" width="476" height="333" rx="23" fill="url(#paint1_linear_18_87)"/></g><g clip-path="url(#clip1_18_87)"><path opacity="0.63" d="M317.535 290.735L299.615 265.055L268.735 309.285H330.495L318.005 291.395C317.855 291.165 317.695 290.955 317.535 290.735ZM315.875 292.595C316.365 293.315 316.875 294.055 317.295 294.845C312.935 302.485 306.565 306.845 299.745 306.845C292.925 306.845 286.555 302.475 282.195 294.845C286.555 287.205 292.925 282.845 299.745 282.845C305.635 282.845 311.185 286.105 315.405 291.915L315.875 292.595ZM309.125 282.925C306.203 281.236 302.879 280.366 299.504 280.407C296.128 280.447 292.826 281.397 289.945 283.155L299.615 269.305L309.125 282.925ZM273.405 306.855L280.475 296.715C282.869 300.925 286.337 304.424 290.525 306.855H273.405ZM308.965 306.855C313.086 304.465 316.51 301.038 318.895 296.915L325.825 306.855H308.965ZM299.615 286.395C297.981 286.427 296.392 286.94 295.048 287.871C293.705 288.802 292.666 290.109 292.062 291.628C291.458 293.147 291.317 294.811 291.655 296.41C291.993 298.009 292.796 299.473 293.963 300.618C295.129 301.763 296.608 302.538 298.214 302.845C299.819 303.153 301.48 302.979 302.987 302.347C304.495 301.714 305.782 300.65 306.687 299.289C307.592 297.928 308.075 296.33 308.075 294.695C308.052 292.473 307.147 290.352 305.561 288.796C303.975 287.24 301.837 286.376 299.615 286.395ZM299.615 300.565C298.46 300.539 297.338 300.174 296.39 299.513C295.442 298.853 294.71 297.927 294.286 296.853C293.861 295.778 293.763 294.602 294.004 293.472C294.245 292.342 294.814 291.309 295.64 290.501C296.466 289.693 297.512 289.146 298.647 288.93C299.782 288.714 300.956 288.838 302.021 289.285C303.086 289.733 303.995 290.485 304.634 291.448C305.274 292.41 305.615 293.54 305.615 294.695C305.574 296.258 304.923 297.744 303.802 298.835C302.682 299.925 301.179 300.536 299.615 300.535V300.565ZM316.865 281.625L329.405 273.195L330.765 275.195L318.225 283.625L316.865 281.625ZM313.465 276.235L311.465 274.885L319.085 263.535L321.085 264.885L313.465 276.235ZM321.525 288.955L335.335 286.125L335.825 288.505L322.015 291.345L321.525 288.955ZM281.005 283.645L268.465 275.215L269.825 273.215L282.365 281.645L281.005 283.645ZM285.765 276.235L278.145 264.885L280.145 263.535L287.765 274.885L285.765 276.235ZM277.215 291.345L263.405 288.505L263.895 286.125L277.705 288.955L277.215 291.345Z" fill="url(#paint2_linear_18_87)" stroke="url(#paint3_linear_18_87)" stroke-width="0.2" stroke-miterlimit="10"/></g></g><defs><filter id="filter0_ddii_18_87" x="22" y="100" width="606" height="463" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="13" dy="3"/><feGaussianBlur stdDeviation="7"/><feComposite in2="hardAlpha" operator="out"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.06 0"/><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_18_87"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="25" dy="41"/><feGaussianBlur stdDeviation="32.5"/><feComposite in2="hardAlpha" operator="out"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.19 0"/><feBlend mode="normal" in2="effect1_dropShadow_18_87" result="effect2_dropShadow_18_87"/><feBlend mode="normal" in="SourceGraphic" in2="effect2_dropShadow_18_87" result="shape"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="-14"/><feGaussianBlur stdDeviation="12"/><feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.19 0"/><feBlend mode="normal" in2="shape" result="effect3_innerShadow_18_87"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="16" dy="-2"/><feGaussianBlur stdDeviation="9.5"/><feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1"/><feColorMatrix type="matrix" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.45 0"/><feBlend mode="normal" in2="effect3_innerShadow_18_87" result="effect4_innerShadow_18_87"/></filter><radialGradient id="paint0_radial_18_87" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(416.123 -25.7893) rotate(118.267) scale(960.105 993.163)"><stop offset="0.229041" stop-color="#F5DDD5"/><stop offset="0.72554" stop-color="#5580C4"/></radialGradient><linearGradient id="paint1_linear_18_87" x1="247.704" y1="158.446" x2="618.375" y2="318.452" gradientUnits="userSpaceOnUse"><stop stop-color="#ECECEC"/><stop offset="1" stop-color="#B0B0B1"/></linearGradient><linearGradient id="paint2_linear_18_87" x1="230.615" y1="161.885" x2="341.925" y2="371.765" gradientUnits="userSpaceOnUse"><stop offset="0.08" stop-color="white"/><stop offset="0.2" stop-color="#F9F9F9"/><stop offset="0.34" stop-color="#EAEAEA"/><stop offset="0.5" stop-color="#D0D0D0"/><stop offset="0.67" stop-color="#ABABAB"/><stop offset="0.85" stop-color="#7D7D7D"/><stop offset="0.89" stop-color="#707070"/></linearGradient><linearGradient id="paint3_linear_18_87" x1="263.285" y1="286.375" x2="335.945" y2="286.375" gradientUnits="userSpaceOnUse"><stop offset="0.25" stop-color="#BFBFBF"/><stop offset="0.36" stop-color="#B4B4B4"/><stop offset="0.68" stop-color="#999999"/><stop offset="0.87" stop-color="#8F8F8F"/></linearGradient><clipPath id="clip0_18_87"><rect width="600" height="580" fill="white"/></clipPath><clipPath id="clip1_18_87"><rect width="72.66" height="46.03" fill="white" transform="translate(263.285 263.365)"/></clipPath></defs>'
    ];

    // Stickers are just an SVG
    string[] private _allStickers;

    // maps a tokenId to an array of stickerInstances
    mapping(uint256 => StickerInstance[]) public _tokenMapToStickerInstances;

    // maps tokenID to laptop style
    mapping(uint256 => uint256) public _tokenMapToLaptop;

    function tokenURI(uint256 tokenId) override public view returns (string memory) {
        string memory prefix = _laptops[_tokenMapToLaptop[tokenId]];
        string memory suffix = '</svg>';

        string memory stickerSVGs = prefix;

        StickerInstance[] memory stickerInstances = _tokenMapToStickerInstances[tokenId];

        for (uint i=0; i < stickerInstances.length; i++) {
            StickerInstance memory sticker = stickerInstances[i];

            stickerSVGs = string.concat(stickerSVGs, '<!--', toString(i), '-->');
            
            if (!sticker.isDeleted) {
                stickerSVGs = string.concat(stickerSVGs, '<g transform="translate(', toString(sticker.x), ', ', toString(sticker.y), ')">');
                stickerSVGs = string.concat(stickerSVGs, _allStickers[sticker.id]);
                stickerSVGs = string.concat(stickerSVGs, '</g>');  
            }
        }

        stickerSVGs = string.concat(stickerSVGs, suffix);

        string memory json = Base64.encode(bytes(string(abi.encodePacked('{"name": "WE3 Offsite, Italy 2022", "image": "data:image/svg+xml;base64,', Base64.encode(bytes(stickerSVGs)), '"}'))));
        string memory output = string(abi.encodePacked('data:application/json;base64,', json));

        return output;
    }

    // TODO, just mint the next available
    function claim(uint256 tokenId) public nonReentrant {
        _safeMint(_msgSender(), tokenId);
        _tokenMapToLaptop[tokenId] = 0;
    }

    function addNewSticker(string calldata svgCode) public nonReentrant {
        _allStickers.push(svgCode);
    }

    function addStickerToLaptop(
        uint256 stickerId, 
        uint256 x, 
        uint256 y, 
        uint256 tokenId) public {
        require(_isApprovedOrOwner(_msgSender(), tokenId), "You're not the owner of this NFT");
        require(stickerId > 0, "Sticker 0 is special");

        _addStickerToToken(stickerId, x, y, tokenId);
    }

    function adminOnlyaddStickerToToken (
        uint256 stickerId, 
        uint256 x, 
        uint256 y, 
        uint256 tokenId) public onlyOwner {

        _addStickerToToken(stickerId, x, y, tokenId);
    }

    function _addStickerToToken(
        uint256 stickerId, 
        uint256 x, 
        uint256 y, 
        uint256 tokenId) internal nonReentrant {
        require(stickerId < _allStickers.length, "That sticker doesn't exist");
        _tokenMapToStickerInstances[tokenId].push(StickerInstance(x, y, stickerId, false));
    } 

    // StickerId is order of sticker for this particular token
    // Not index of allStickers
    function removeSticker(uint256 stickerId, uint256 tokenId) public nonReentrant {
        require(_isApprovedOrOwner(_msgSender(), tokenId), "You're not the owner of this NFT");
        _tokenMapToStickerInstances[tokenId][stickerId].isDeleted = true;
    } 

    function changeLaptop(uint256 laptopId, uint256 tokenId) public nonReentrant {
        require(_isApprovedOrOwner(_msgSender(), tokenId), "You're not the owner of this NFT");
        require(laptopId < _laptops.length, "laptopId is too high");
        _tokenMapToLaptop[tokenId] = laptopId;
    } 

    function toString(uint256 value) internal pure returns (string memory) {
    // Inspired by OraclizeAPI's implementation - MIT license
    // https://github.com/oraclize/ethereum-api/blob/b42146b063c7d6ee1358846c198246239e9360e8/oraclizeAPI_0.4.25.sol

        if (value == 0) {
            return "0";
        }
        uint256 temp = value;
        uint256 digits;
        while (temp != 0) {
            digits++;
            temp /= 10;
        }
        bytes memory buffer = new bytes(digits);
        while (value != 0) {
            digits -= 1;
            buffer[digits] = bytes1(uint8(48 + uint256(value % 10)));
            value /= 10;
        }
        return string(buffer);
    }
    
    constructor() ERC721("Italia", "ITAL") Ownable() {

    }
}